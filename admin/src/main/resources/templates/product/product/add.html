<!DOCTYPE html>
<html>
<meta charset="utf-8">
<head th:include="include :: header"></head>
<body class="gray-bg">
	<div class="wrapper wrapper-content ">
		<div class="row">
			<div class="col-sm-12">
				<div class="ibox float-e-margins">
					<div class="ibox-content">
						<form class="form-horizontal m-t" id="signupForm">
							<div class="form-group">
								<label class="col-sm-3 control-label">商品类型：</label>
								<div class="col-sm-8">
									<select class="form-control" id="typePid" name="typePid"
										onchange="selectType(this.options[this.options.selectedIndex].value)">
										<option>类型选择</option>
										<option th:each="type,userStat:${typeList}"
											th:value="${type.id}" th:text="${type.name}"></option>
									</select>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-3 control-label">商品名称：</label>
								<div class="col-sm-8">
									<input id="name" name="name" class="form-control" type="text">
									<input id="shopId" name="shopId" class="form-control"
										type="hidden">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">商品介绍：</label>
								<div class="col-sm-8">
									<input id="memo" name="memo" class="form-control" type="text">
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">商品图片：</label>
								<div class="col-sm-8">
									<button id="test1" type="button">
										<span class="glyphicon glyphicon-plus" aria-hidden="true"></span>
									</button>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">商品规格：</label>
								<div class="col-sm-8" id="_dimension">
									<button class="btn btn-default" type="button" onclick = "openTree()">选择商品规格</button>
								</div>
							</div>
							<div class="form-group">
								<label class="col-sm-3 control-label">：</label>
								<div class="col-sm-8">
									<input id="status" name="status" class="form-control"
										type="text">
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-3 control-label">：</label>
								<div class="col-sm-8">
									<input id="type" name="type" class="form-control" type="text">
								</div>
							</div>
							<div class="form-group">
								<div class="col-sm-8 col-sm-offset-3">
									<button type="submit" class="btn btn-primary">提交</button>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- 模态框（Modal） -->
	<div class="modal fade" id="treeModel" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel" aria-hidden="true" style="display:none">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="myModalLabel">规格</h4>
				</div>
				<div class="modal-body" id ="_dimensionModel">
					<table id="_dimensionTree" data-mobile-responsive="true">
					</table>	
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
					<button type="button" class="btn btn-primary" onclick = "getChecked()">提交更改</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal -->
	</div>


	<div th:include="include::footer"></div>
	<script type="text/javascript" src="/js/appjs/product/product/add.js">
		
	</script>
	<!-- 全局js -->
	<script src="/js/bootstrap.min.js?v=3.3.6"></script>
	<script src="/js/bootstrap-paginator.min.js"></script>

	<script src="/js/content.js?v=1.0.0"></script>
	<script src="/js/layui.js"></script>
	<script src="/js/plugins/clipboard/clipboard.min.js"></script>
	<script src="/js/plugins/layer/layer.min.js"></script>
	<script src="/js/vue.min.js"></script>

	<script type="text/javascript">
		layui.use(
						'upload',
						function() {
							var upload = layui.upload;
							//执行实例
							var uploadInst = upload
									.render({
										elem : '#test1', //绑定元素
										url : '/file/resource/upload', //上传接口
										size : 1000,
										accept : 'file',
										done : function(r) {
											layer.msg(r.msg);
											layer.msg(r.data);
											$("#test1")
													.before(
															"<a href=''#' class='thumbnail' ><img src = '"+r.resource.thumb+"' style = 'width:128px;height:128px'/> </a><input name = '_imghidden' type='hidden' value='"+r.resource.id+"'/>");
										},
										error : function(r) {
											layer.msg(r.msg);
										}
									});
						});

		function selectType(id) {

			$.ajax({

						type : "GET",

						url : "/product/productType/listNoPage",

						data : {
							"pid" : id
						},

						dataType : "json",

						success : function(data) {
							if (data.length > 0) {

								var html = '<select id="typeId" name="typeId" class="form-control" >';

								$.each(data, function(commentIndex, comment) {
									html += '<option value = '+this.id+'>'
											+ this.name + '</option>'
								});

								html += '</select>'

								alert(html);

								$('#typePid').after(html);
							}
						}

					});
		}

		function selectDimension(typeId) {
			$.ajax({

						type : "GET",

						url : "/product/productType/listNoPage",

						data : {
							"pid" : id
						},

						dataType : "json",

						success : function(data) {
							if (data.length > 0) {

								var html = '<select id="typeId" name="typeId" class="form-control" onchange = "">';

								$.each(data, function(commentIndex, comment) {
									html += '<option value = '+this.id+'>'
											+ this.name + '</option>'
								});

								html += '</select>'

								alert(html);

								$('#typePid').after(html);
							}
						}

					});
		}
		
		function openTree(){
			var typeId = $("#typeId").val();
			alert(typeId)
			tree(typeId);
			$("#treeModel").modal('show');
		}

		function tree(typeId) {
			$('#_dimensionTree').bootstrapTreeTable({
				id : 'id',
				code : 'id',
				parentCode : 'pid',
				type : "GET", // 请求数据的ajax类型
				url : '/product/dimension/listByType/' + typeId, // 请求数据的ajax的url
				ajaxParams : {}, // 请求数据的ajax的data属性
				expandColumn : '1',// 在哪一列上面显示展开按钮
				striped : true, // 是否各行渐变色
				bordered : true, // 是否显示边框
				expandAll : true, // 是否全部展开
				// toolbar : '#exampleToolbar',
				columns : [  {
					field : '<input name="select_item" type="checkbox" ></input>',
					width : '50px',
					formatter:function(value,row,index){
						return '<input id = "'+value.id+'" name="'+value.pid+'" data-pid= "'+value.pid+'" data-name="'+value.name+'" type="checkbox" value="'+value.id+'" onclick = "checkBoxTree('+value.pid+','+value.id+')"></input>';
					}
					
				},{
					title : '编号',
					field : 'id',
					visible : false,
					align : 'center',
					valign : 'middle',
					width : '50px'
				}, {
					title : '规格名称',
					field : 'name',
					width : '150px'
				} ]
			});
		}
		
		function checkBoxTree(pid,id){
			if($("#"+id).prop('checked')){
				$("#"+id).prop("checked",true);
				$("input[name = '"+id+"']").each(function(index,elem){
					$(elem).prop("checked",true);
				});
			}else{
				$("#"+id).prop("checked",false);
				$("input[name = '"+id+"']").each(function(index,elem){
					$(elem).prop("checked",false);
				});
				
			
			}
		}
		
		function getChecked(){
			$.each($('input:checkbox:checked'),function(index,elem){
				$("#_dimension").after()
				
                 alert($(elem).val());
            });
		}
	</script>
</body>
</html>
